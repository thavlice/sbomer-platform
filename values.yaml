# Global settings for the platform
global:
  # Include basic infrastructure setup (mainly for local development)
  includeKafka: true
  includeApicurio: true
  includeApiGateway: true
  includeStatusDb: true
  includeS3: true
  includeMockServices: true
  includeUnleash: true

wiremock:
    # Additional configmaps for wiremock can be attached by overriding this by the parent chart
    extraMappingConfigMaps: []
      
# Configuration for the internal Dev infrastructure
infra:
  # KAFKA CONFIG
  kafka:
    image: quay.io/strimzi/kafka:latest-kafka-3.7.0
    storageClass: "standard"
  # APICURIO CONFIG
  apicurio:
    image: quay.io/apicurio/apicurio-registry:latest
  gateway:
    route:
      enabled: false
      host: ""
  # POSTGRESQL CONFIG (Status DB)
  statusDb:
    image: quay.io/fedora/postgresql-16:latest
    env:
      database: sbomer_status
      user: sbomer
      password: sbomer_password
    service:
      port: 5432
    storage:
      size: 1Gi
      # For local dev no persistence needed
      persistenceEnabled: false 
  # MINIO CONFIG (S3)
  minio:
    image: quay.io/minio/minio:latest
    rootUser: minioadmin
    rootPassword: minioadmin
    service:
      apiPort: 9000
      consolePort: 9001
    storage:
      size: 5Gi
      persistenceEnabled: false
  # UNLEASHED CONFIG
  unleash:
    db:
      image: quay.io/fedora/postgresql-16:latest
      name: unleash
      username: unleash_user
      password: unleash_password
    server:
      # currently from dockerhub for lack of alternatives, also since it will only be used during local development
      image: docker.io/unleashorg/unleash-server:latest
      # The full public URL (used for invites, reset password links, etc.)
      externalUrl: "http://localhost:8080/unleash"
      # The subpath where Unleash is mounted (must match your Nginx location)
      basePath: "/unleash"
      # Default token from your compose file
      apiToken: "default:development.unleash-insecure-api-token" 
      service:
        port: 4242

# --- Override Child Charts ---
# Child components are by default looking at the Kafka and Apicurio instances set up by include flags above. 
# Override in prod to point to instances running in prod

manifest-storage-service-chart:
  config:
    storagePublicApiUrl: "http://localhost:8080"
    kafka:
      # In K8s, the host is the Service name.
      # Format: <release-name>-kafka.<namespace>.svc
      bootstrapServers: "sbomer-release-kafka:9092"
      schemaRegistryUrl: "http://sbomer-release-apicurio:8080/apis/registry/v2"

sbom-service-chart:
  config:
    kafka:
      bootstrapServers: "sbomer-release-kafka:9092"
      schemaRegistryUrl: "http://sbomer-release-apicurio:8080/apis/registry/v2"
    database:
      existingSecret: "sbomer-release-status-db-secret"

syft-generator-chart:
  config:
    kafka:
      bootstrapServers: "sbomer-release-kafka:9092"
      schemaRegistryUrl: "http://sbomer-release-apicurio:8080/apis/registry/v2"
    # In a real K8s cluster, we don't use 'host.containers.internal'.
    # Quarkus usually auto-detects Kubernetes if RBAC is set up, 
    # otherwise point to the internal K8s API service:
    quarkus:
      kubernetesClientMasterUrl: "https://kubernetes.default.svc" 
      trustCerts: "false" # Should be false in prod, true in dev
    # Default internal cluster URL for storage
    storageUrl: "http://sbomer-release-manifest-storage-service-chart:8080"

# ui, configure to point to sbomer-service
ui-chart:
  config:
    apiUrl: "http://localhost:8080"
